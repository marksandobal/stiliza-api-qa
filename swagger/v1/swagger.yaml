openapi: 3.0.1
info:
  title: STILIZA API V1
  version: v1
  description: "Api documentation from stiliza with JWT"
paths:
  /signup:
    post:
      summary: Creates a new user
      tags:
      - Registrations
      requestBody:
        $ref: '#/components/requestBodies/UserSignUp'
      responses:
        '200':
          description: User created successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /login:
    post:
      summary: Logs in a user
      tags:
      - Sessions
      requestBody:
        $ref: '#/components/requestBodies/UserLogin'
      responses:
        '200':
          description: User logged in successfully
        '401':
          $ref: '#/components/responses/Unauthorized'

  /logout:
    delete:
      summary: Logs out a user
      tags:
      - Sessions
      security:
      - bearer_auth: []
      responses:
        '200':
          description: User logged out successfully
        '401':
          $ref: '#/components/responses/Unauthorized'

  /password:
    post:
      summary: Sends password reset instructions
      tags:
      - Passwords
      requestBody:
        $ref: '#/components/requestBodies/PasswordResetRequest'
      responses:
        '200':
          description: Password reset instructions sent successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
    put:
      summary: Resets user password
      tags:
      - Passwords
      requestBody:
        $ref: '#/components/requestBodies/PasswordReset'
      responses:
        '200':
          description: Password reset successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /users/verification:
    post:
      summary: Verifies a user account
      tags:
      - Verification
      requestBody:
        $ref: '#/components/requestBodies/UserVerification'
      responses:
        '200':
          description: User verified successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /users/resend_verification:
    post:
      summary: Resends verification email
      tags:
      - Verification
      requestBody:
        $ref: '#/components/requestBodies/ResendVerification'
      responses:
        '200':
          description: Verification email resent successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /api/studios:
    get:
      summary: Lists all studios for the current company
      tags:
      - Studios
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: A list of studios
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  studios:
                    type: array
                    items:
                      $ref: '#/components/schemas/Studio'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Company not found

    post:
      summary: Creates a new studio
      tags:
      - Studios
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/StudioCreate'
      responses:
        '201':
          description: Studio created successfully
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  studio:
                    $ref: '#/components/schemas/Studio'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /api/studios/{id}:
    get:
      summary: Shows a specific studio
      tags:
      - Studios
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Studio details
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  studio:
                    $ref: '#/components/schemas/Studio'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      summary: Updates a studio
      tags:
      - Studios
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/StudioUpdate'
      responses:
        '200':
          description: Studio updated successfully
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  studio:
                    $ref: '#/components/schemas/Studio'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/branches:
    get:
      summary: Lists all branches for the current studio
      tags:
      - Branches
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: A list of branches
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  branches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Branch'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      summary: Creates a new branch
      tags:
      - Branches
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/BranchCreate'
      responses:
        '201':
          description: Branch created successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /api/branches/{id}:
    get:
      summary: Shows a specific branch
      tags:
      - Branches
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Branch details
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  branch:
                    $ref: '#/components/schemas/Branch'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      summary: Updates a branch
      tags:
      - Branches
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/BranchUpdate'
      responses:
        '200':
          description: Branch updated successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Archives a branch
      tags:
      - Branches
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Branch archived successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /api/branches/{branch_id}/rooms:
    post:
      summary: Creates a new room in a branch
      tags:
      - Rooms
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: branch_id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/RoomCreate'
      responses:
        '201':
          description: Room created successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /api/branches/{branch_id}/rooms/{id}:
    get:
      summary: Shows a specific room
      tags:
      - Rooms
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: branch_id
        in: path
        required: true
        schema:
          type: string
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Room details
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  room:
                    $ref: '#/components/schemas/Room'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      summary: Updates a room
      tags:
      - Rooms
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: branch_id
        in: path
        required: true
        schema:
          type: string
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/RoomUpdate'
      responses:
        '200':
          description: Room updated successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Archives a room
      tags:
      - Rooms
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: branch_id
        in: path
        required: true
        schema:
          type: string
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Room archived successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /api/branches/{branch_id}/schedules/{id}:
    get:
      summary: Shows a specific schedule
      tags:
      - Schedules
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: branch_id
        in: path
        required: true
        schema:
          type: string
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Schedule details
          content:
            application/vnd.stiliza-api.v1+json:
              schema:
                type: object
                properties:
                  schedule:
                    $ref: '#/components/schemas/Schedule'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      summary: Updates a schedule
      tags:
      - Schedules
      parameters:
      - $ref: '#/components/parameters/AcceptHeader'
      - $ref: '#/components/parameters/CurrentStudioId'
      - name: branch_id
        in: path
        required: true
        schema:
          type: string
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: Current-Company-Id
        in: header
        required: true
        schema:
          type: string
      requestBody:
        $ref: '#/components/requestBodies/ScheduleUpdate'
      responses:
        '200':
          description: Schedule updated successfully
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '404':
          $ref: '#/components/responses/NotFound'

servers:
- url: https://stiliza-api-qa.onrender.com
  variables:
    defaultHost:
      default: stiliza-api-qa.onrender.com
      description: Staging server
- url: http://localhost:3000
  variables:
    defaultHost:
      default: localhost:3000
      description: Local server


components:
  securitySchemes:
    bearer_auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
 
  parameters:
    AcceptHeader:
      name: Accept
      in: header
      required: true
      schema:
        type: string
        default: application/vnd.stiliza-api.v1+json
      description: API version header
    CurrentStudioId:
      name: Current-Studio-Id
      in: header
      required: true
      schema:
        type: string
      description: ID of the current studio

  schemas:
    User:
      type: object
      required:
      - email
      - password
      - password_confirmation
      - role
      properties:
        email:
          type: string
          example: user@mail.com
        password:
          type: string
          example: "123456789"
        password_confirmation:
          type: string
          example: "123456789"
        role:
          type: string
          enum: ["admin", "user"]
          example: "admin"
    UserProfile:
      type: object
      required:
      - name
      - last_name
      - gender
      properties:
        name:
          type: string
          example: "John Doe"
        last_name:
          type: string
          example: "Doe"
        second_last_name:
          type: string
          example: "Swit"
        gender:
          type: string
          enum: ["male", "female"]
          example: "male"
        birth_date:
          type: string
          example: "2026-01-02"
    Company:
      type: object
      properties:
        name:
          type: string
          example: "Name Company"
    Error:
      type: object
      properties:
        error:
          type: string
        errors:
          type: object
        suggestion:
          type: string
    MessageResponse:
      type: object
      properties:
        message:
          type: string
    Studio:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        profile_thumb_url:
          type: string
          format: uri
        banner_desktop_url:
          type: string
          format: uri
        banner_mobile_url:
          type: string
          format: uri
        qr_profile_url:
          type: string
          format: uri
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        digital_channels:
          type: array
          items:
            $ref: '#/components/schemas/DigitalChannel'
    DigitalChannel:
      type: object
      properties:
        id:
          type: integer
        channel_type:
          type: string
          enum: [whatsapp, instagram, tiktok, facebook]
        value:
          type: string
    Branch:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        phone:
          type: string
        email:
          type: string
        address:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        timezone:
          type: string
        active:
          type: boolean
        rooms:
          type: array
          items:
            $ref: '#/components/schemas/Room'
        schedules:
          type: array
          items:
            $ref: '#/components/schemas/Schedule'
    Room:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        capacity:
          type: integer
        layout:
          type: string
    Schedule:
      type: object
      properties:
        id:
          type: integer
        day_of_week:
          type: integer
        start_time:
          type: string
          format: time
        end_time:
          type: string
          format: time
        active:
          type: boolean
        branch_id:
          type: integer

  requestBodies:
    UserSignUp:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              user:
                type: object
                properties:
                  email:
                    type: string
                    example: user@mail.com
                  password:
                    type: string
                    example: "123456789"
                  password_confirmation:
                    type: string
                    example: "123456789"
                  role:
                    type: string
                    enum: ["admin", "user"]
                    example: "admin"
                  user_profile_attributes:
                    $ref: '#/components/schemas/UserProfile'
                  company_attributes:
                    $ref: '#/components/schemas/Company'
    UserLogin:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              user:
                type: object
                properties:
                  email:
                    type: string
                    example: user@mail.com
                  password:
                    type: string
                    example: "123456789"
    PasswordResetRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              user:
                type: object
                properties:
                  email:
                    type: string
                    example: user@mail.com
    PasswordReset:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              user:
                type: object
                properties:
                  email:
                    type: string
                    example: user@mail.com
                  reset_password_token:
                    type: string
                  password:
                    type: string
                  password_confirmation:
                    type: string
    UserVerification:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
                example: user@mail.com
              code:
                type: string
                example: 123456
    ResendVerification:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
                example: user@mail.com
    StudioCreate:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              studio[name]:
                type: string
              studio[description]:
                type: string
              studio[handle]:
                type: string
              studio[profile]:
                type: string
                format: binary
              studio[banner]:
                type: string
                format: binary
              studio[digital_channels_attributes]:
                type: array
                items:
                  type: object
                  properties:
                    channel_type:
                      type: string
                      enum: [whatsapp, instagram, tiktok, facebook]
                    value:
                      type: string
    StudioUpdate:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              studio[name]:
                type: string
              studio[description]:
                type: string
              studio[profile]:
                type: string
                format: binary
              studio[banner]:
                type: string
                format: binary
              studio[digital_channels_attributes]:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                    channel_type:
                      type: string
                      enum: [whatsapp, instagram, tiktok, facebook]
                    value:
                      type: string
                    _destroy:
                      type: boolean
              studio:
                type: object
                properties:
                  name:
                    type: string
                  description:
                    type: string
                  digital_channels_attributes:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        channel_type:
                          type: string
                          enum: [whatsapp, instagram, tiktok, facebook]
                        value:
                          type: string
                        _destroy:
                          type: boolean
    BranchCreate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              branch:
                type: object
                properties:
                  name:
                    type: string
                  phone:
                    type: string
                  email:
                    type: string
                  address:
                    type: string
                  latitude:
                    type: number
                  longitude:
                    type: number
                  timezone:
                    type: string
                  active:
                    type: boolean
                  rooms_attributes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Room'
                  schedules_attributes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Schedule'
    BranchUpdate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              branch:
                type: object
                properties:
                  name:
                    type: string
                  phone:
                    type: string
                  email:
                    type: string
                  address:
                    type: string
                  latitude:
                    type: number
                  longitude:
                    type: number
                  timezone:
                    type: string
                  active:
                    type: boolean
    RoomCreate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              room:
                type: object
                properties:
                  name:
                    type: string
                  capacity:
                    type: integer
                  layout:
                    type: string
    RoomUpdate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              room:
                type: object
                properties:
                  name:
                    type: string
                  capacity:
                    type: integer
                  layout:
                    type: string
    ScheduleUpdate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              schedule:
                type: object
                properties:
                  day_of_week:
                    type: integer
                  start_time:
                    type: string
                    format: time
                  end_time:
                    type: string
                    format: time
                  active:
                    type: boolean

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    UnprocessableEntity:
      description: Unprocessable entity
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    OK:
      description: Success
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/MessageResponse'
    Created:
      description: Created
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/MessageResponse'

security:
- bearer_auth: []
